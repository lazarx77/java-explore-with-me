# java-explore-with-me

# О проекте

## Автор
Олег Лазаренко

## Описание

Этот проект представляет собой веб-приложение для работы с подборками событий, которое предоставляет следующие 
контроллеры для управления данными:

- **AdminController**: контроллер для администраторов, который позволяет управлять данными на уровне администратора.
- **PrivateController**: контроллер для авторизованных пользователей, который позволяет управлять данными на уровне 
- авторизованного пользователя.
- **PublicController**: контроллер для неавторизованных пользователей, который позволяет управлять данными на уровне 
- публичного доступа.
- **StatServerController**: контроллер для обработки статистических данных на сервере.

## Стэк

- Java amazon corretto 21
- Spring Boot
- PostgreSQL
- Spring Data JPA
- Lombok
- Docker
- Docker Compose

# AdminController

Контроллер `AdminController` предназначен для выполнения административных операций в приложении. Он обрабатывает 
запросы на создание, обновление и удаление пользователей, категорий, событий и подборок. Контроллер использует 
аннотации Spring для обработки HTTP-запросов и валидации входящих данных.

## Основные функции

### Пользователи

- **Создание пользователя**
    - **Метод:** `POST /admin/users`
    - **Описание:** Создает нового пользователя.
    - **Параметры:** Данные нового пользователя передаются в теле запроса.
    - **Ответ:** Возвращает созданного пользователя с его данными.

- **Получение списка пользователей**
    - **Метод:** `GET /admin/users`
    - **Описание:** Получает список пользователей с поддержкой пагинации.
    - **Параметры:**
        - `from` (int): Индекс для пагинации (по умолчанию 0).
        - `size` (int): Количество пользователей для выборки (по умолчанию 10).
        - `ids` (Long[]): Массив идентификаторов пользователей (необязательно).
    - **Ответ:** Возвращает список пользователей.

- **Удаление пользователя**
    - **Метод:** `DELETE /admin/users/{userId}`
    - **Описание:** Удаляет пользователя по идентификатору.
    - **Параметры:** `userId` (Long): Идентификатор пользователя.
    - **Ответ:** 204 No Content.

### Категории

- **Создание категории**
    - **Метод:** `POST /admin/categories`
    - **Описание:** Создает новую категорию.
    - **Параметры:** Данные новой категории передаются в теле запроса.
    - **Ответ:** Возвращает созданную категорию.

- **Обновление категории**
    - **Метод:** `PATCH /admin/categories/{catId}`
    - **Описание:** Обновляет существующую категорию.
    - **Параметры:**
        - `catId` (Long): Идентификатор категории.
        - `dto` (CategoryDto): Данные для обновления категории.
    - **Ответ:** Возвращает обновленную категорию.

- **Удаление категории**
    - **Метод:** `DELETE /admin/categories/{catId}`
    - **Описание:** Удаляет категорию по идентификатору.
    - **Параметры:** `catId` (Long): Идентификатор категории.
    - **Ответ:** 204 No Content.

### События

- **Обновление события**
    - **Метод:** `PATCH /admin/events/{eventId}`
    - **Описание:** Обновляет событие администратором.
    - **Параметры:**
        - `eventId` (Long): Идентификатор события.
        - `dto` (UpdateEventAdminRequest): Данные для обновления события.
    - **Ответ:** Возвращает обновленное событие.

- **Получение списка событий**
    - **Метод:** `GET /admin/events`
    - **Описание:** Получает список событий с возможностью фильтрации и пагинации.
    - **Параметры:**
        - `users` (Long[]): Массив идентификаторов пользователей (необязательно).
        - `states` (String[]): Массив состояний событий (необязательно).
        - `categories` (Long[]): Массив идентификаторов категорий (необязательно).
        - `rangeStart` (LocalDateTime): Начало диапазона дат (необязательно).
        - `rangeEnd` (LocalDateTime): Конец диапазона дат (необязательно).
        - `from` (int): Индекс для пагинации (по умолчанию 0).
        - `size` (int): Количество событий (по умолчанию 10).
    - **Ответ:** Возвращает список событий.

- **Получение ожидающих публикации событий**
    - **Метод:** `GET /admin/events/pending`
    - **Описание:** Получает список ожидающих публикации событий.
    - **Ответ:** Возвращает список объектов `PrivateEventFullDto` с ожидающими событиями.

### Подборки

- **Создание подборки**
    - **Метод:** `POST /admin/compilations`
    - **Описание:** Создает новую подборку событий.
    - **Параметры:** Данные для новой подборки передаются в теле запроса.
    - **Ответ:** Возвращает созданную подборку.

- **Обновление подборки**
    - **Метод:** `PATCH /admin/compilations/{compId}`
    - **Описание:** Обновляет существующую подборку событий.
  - **Параметры:**
      - `compId` (Long): Идентификатор подборки.
      - `dto` (UpdateCompilationRequestDto): Данные для обновления подборки.
  - **Ответ:** Возвращает обновленную подборку.

- **Удаление подборки**
    - **Метод:** `DELETE /admin/compilations/{compId}`
    - **Описание:** Удаляет подборку по идентификатору.
    - **Параметры:** `compId` (Long): Идентификатор подборки.
    - **Ответ:** 204 No Content.

## Примечания

- Все методы контроллера используют аннотации для валидации входящих данных, что обеспечивает корректность и 
- безопасность обработки запросов.
- Контроллер поддерживает кросс-доменные запросы (CORS), что позволяет взаимодействовать с ним из различных источников.
- Логирование осуществляется с помощью библиотеки SLF4J, что позволяет отслеживать вызовы методов и упрощает отладку.

## Зависимости

Контроллер зависит от следующих сервисов:
- `UserService` — для управления пользователями.
- `CategoryService` — для управления категориями.
- `EventService` — для управления событиями.
- `CompilationService` — для управления подборками событий.

## Пример использования

### Создание нового пользователя

```http
POST /admin/users
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john.doe@example.com"
}
```

# PrivateController

Контроллер `PrivateController` предназначен для управления событиями и запросами на участие пользователей. Он 
обрабатывает запросы, связанные с событиями, которые созданы пользователями, и предоставляет функциональность для 
добавления, получения, обновления событий и управления запросами на участие.

## Основные функции

### Добавление нового события

- **Метод:** `POST /users/{userId}/events`
- **Описание:** Добавляет новое событие для пользователя.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
    - `dto` (NewEventDto): Данные нового события.
- **Ответ:** Возвращает созданное событие (EventFullDto).

### Получение списка событий пользователя

- **Метод:** `GET /users/{userId}/events`
- **Описание:** Получает список событий пользователя с пагинацией.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
    - `from` (int): Индекс для пагинации (по умолчанию 0).
    - `size` (int): Количество событий для выборки (по умолчанию 10).
- **Ответ:** Возвращает список событий (List<EventShortDto>).

### Получение события по идентификатору

- **Метод:** `GET /users/{userId}/events/{eventId}`
- **Описание:** Получает событие по идентификатору пользователя и события.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
    - `eventId` (Long): Идентификатор события.
- **Ответ:** Возвращает событие (PrivateEventFullDto).

### Обновление события пользователя

- **Метод:** `PATCH /users/{userId}/events/{eventId}`
- **Описание:** Обновляет событие пользователя.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
    - `eventId` (Long): Идентификатор события.
    - `dto` (UpdateEventUserRequest): Данные для обновления события.
- **Ответ:** Возвращает обновленное событие (EventFullDto).

### Добавление запроса на участие в событии

- **Метод:** `POST /users/{userId}/requests`
- **Описание:** Добавляет запрос на участие в событии.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
    - `eventId` (Long): Идентификатор события.
- **Ответ:** Возвращает запрос на участие (ParticipationRequestDto).

### Получение списка запросов на участие пользователя

- **Метод:** `GET /users/{userId}/requests`
- **Описание:** Получает список запросов на участие пользователя.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
- **Ответ:** Возвращает список запросов на участие (List<ParticipationRequestDto>).

### Отмена запроса на участие в событии

- **Метод:** `PATCH /users/{userId}/requests/{reqId}/cancel`
- **Описание:** Отменяет запрос на участие в событии.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
    - `reqId` (Long): Идентификатор запроса.
- **Ответ:** Возвращает отмененный запрос на участие (ParticipationRequestDto).

### Получение запросов на участие в событии

- **Метод:** `GET /users/{userId}/events/{eventId}/requests`
- **Описание:** Получает запросы на участие в событии по идентификатору пользователя и события.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
    - `eventId` (Long): Идентификатор события.
- **Ответ:** Возвращает список запросов на участие (List<ParticipationRequestDto>).

### Обновление статуса запроса на участие в событии

- **Метод:** `PATCH /users/{userId}/events/{eventId}/requests`
- **Описание:** Обновляет статус запроса на участие в событии.
- **Параметры:**
    - `userId` (Long): Идентификатор пользователя.
    - `eventId` (Long): Идентификатор события.
    - `dto` (EventRequestStatusUpdateRequestDto): Данные для обновления статуса запроса.
- **Ответ:** Возвращает результат обновления статуса запроса (EventRequestStatusUpdateResultDto).

## Примечания

- Все методы контроллера используют аннотации для валидации входящих данных
- , что обеспечивает корректность и безопасность обработки запросов.
- Контроллер поддерживает кросс-доменные запросы (CORS), что позволяет взаимодействовать с ним из различных источников.
- Логирование осуществляется с помощью библиотеки SLF4J, что позволяет отслеживать вызовы методов и упрощает отладку.

## Зависимости

Контроллер зависит от следующих сервисов:
- `EventService` — для управления событиями.
- `RequestService` — для управления запросами на участие.

## Пример использования

### Добавление нового события

```http
POST /users/1/events
Content-Type: application/json

{
  "title": "Новый концерт",
  "description": "Описание нового концерта.",
  "eventDate": "2023-12-01T20:00:00",
  "location": {
    "lat": 55.7558,
    "lon": 37.6173
  },
  "participantLimit": 100
}
``` 

# PublicController

Контроллер для обработки публичных запросов к ресурсам приложения. Обеспечивает доступ к категориям, событиям и 
подборкам для пользователей.

## Описание

`PublicController` предоставляет API для работы с категориями, событиями и подборками. Он включает в себя методы для 
получения списков и отдельных элементов, а также для фильтрации и пагинации данных.

## Эндпоинты

### Получение списка категорий

- **URL**: `/categories`
- **Метод**: `GET`
- **Параметры**:
    - `from` (int, по умолчанию: 0) - индекс для пагинации
    - `size` (int, по умолчанию: 10) - количество категорий для выборки
- **Ответ**: `List<CategoryDto>` - список категорий

### Получение категории по идентификатору

- **URL**: `/categories/{catId}`
- **Метод**: `GET`
- **Параметры**:
    - `catId` (Long) - идентификатор категории
- **Ответ**: `CategoryDto` - категория

### Получение события по идентификатору

- **URL**: `/events/{eventId}`
- **Метод**: `GET`
- **Параметры**:
    - `eventId` (Long) - идентификатор события
- **Ответ**: `EventFullDto` - полное описание события

### Получение списка событий

- **URL**: `/events`
- **Метод**: `GET`
- **Параметры**:
    - `text` (String, необязательный) - текст для поиска
    - `categories` (Long[], необязательный) - массив идентификаторов категорий
    - `paid` (Boolean, необязательный) - фильтр по платным событиям
    - `rangeStart` (LocalDateTime, необязательный) - начало диапазона дат
    - `rangeEnd` (LocalDateTime, необязательный) - конец диапазона дат
    - `onlyAvailable` (Boolean, необязательный) - фильтр по доступным событиям
    - `sort` (String, необязательный) - порядок сортировки
    - `from` (int, по умолчанию: 0) - индекс для пагинации
    - `size` (int, по умолчанию: 10) - количество событий для выборки
- **Ответ**: `List<EventShortDto>` - список событий

### Получение списка подборок событий

- **URL**: `/compilations`
- **Метод**: `GET`
- **Параметры**:
    - `pinned` (Boolean, необязательный) - фильтр по закрепленным подборкам
    - `from` (int, по умолчанию: 0) - индекс для пагинации
    - `size` (int, по умолчанию: 10) - количество подборок для выборки
- **Ответ**: `List<CompilationDtoResponse>` - список подборок

### Получение подборки по идентификатору

- **URL**: `/compilations/{compId}`
- **Метод**: `GET`
- **Параметры**:
    - `compId` (Long) - идентификатор подборки
- **Ответ**: `CompilationDtoResponse` - подборка

## Зависимости

- `CategoryService` - сервис для работы с категориями
- `EventService` - сервис для работы с событиями
- `StatsClient` - клиент для регистрации статистики
- `CompilationService` - сервис для работы с подборками

## Примечания

- Все методы контроллера используют аннотации валидации для проверки входных параметров.
- Контроллер поддерживает кросс-доменные запросы (CORS).

## Схемы баз данных

![main - public.png](main%20-%20public.png)![stats - public.png](stats%20-%20public.png)

## Дополнительная функциональность

- Добавлена возможность выгрузки администратором всех ожидающих модерации событий по URL
/admin/events/pending.
- При отклонении события администратором, событие переходит в статус отклененное (CANCELED) и имеется возможность
добавить комментарий администратора о причине отклонения.
- При получении подробной информации о событии его инициатором добавлена возможность просмотра комментария примины
отклонения администратором.
- В публичном доступе при просмотре подробной информации о событии комментариев причин отклонения нет.

## Подробная документация javadoc

[Документация]([index.html](javadoc%2Findex.html))